## API Report File for "@zhengxs/wechaty-puppet-dingtalk"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
import { Dingtalk } from '@zhengxs/dingtalk';
import { AuthCredential } from '@zhengxs/dingtalk-auth';
import { HubConnection } from '@zhengxs/dingtalk-event-hubs';
import { FileBoxInterface } from 'file-box';
import Keyv from 'keyv';
import * as PUPPET from 'wechaty-puppet';

// @public (undocumented)
export type ActionCard = {
  title: string;
  text: string;
  btnOrientation: '0' | '1';
  btns: ActionCardButtonStyle[];
};

// @public (undocumented)
export enum ActionCardButtonOrientation {
  // (undocumented)
  Horizontal = '1',
  // (undocumented)
  Vertical = '0',
}

// @public (undocumented)
export type ActionCardButtonStyle = {
  title: string;
  actionURL: string;
};

// @public
export type ActionCardMessagePayload = {
  msgtype: 'actionCard';
  actionCard: SimpleActionCard | ActionCard;
};

// @public (undocumented)
export type AudioMessagePayload = {
  msgtype: 'audio';
  audio: {
    mediaId: string;
    duration: number;
  };
};

// @public (undocumented)
export interface DTAudioMessageRawPayload extends DTMessageRawPayloadBase {
  // (undocumented)
  content: {
    duration: number;
    downloadCode: string;
    recognition: string;
  };
  // (undocumented)
  msgtype: 'audio';
}

// @public (undocumented)
export interface DTContactRawPayload {
  avatar: string;
  corpId: string;
  id: string;
  name: string;
  sessionWebhook: string;
  sessionWebhookExpiredTime: number;
  staffId?: string;
  type: DTContactType;
}

// @public (undocumented)
export function dtContactToWechaty(_: PUPPET.Puppet, payload: DTContactRawPayload): Promise<PUPPET.payloads.Contact>;

// @public (undocumented)
export enum DTContactType {
  // (undocumented)
  Robot = 1,
  // (undocumented)
  User = 2,
}

// @public (undocumented)
export interface DTFileMessageRawPayload extends DTMessageRawPayloadBase {
  // (undocumented)
  content: {
    spaceId: string;
    fileName: string;
    fileId: string;
    downloadCode: string;
  };
  // (undocumented)
  msgtype: 'file';
}

// @public (undocumented)
export type DTMediaMessageRawPayload =
  | DTFileMessageRawPayload
  | DTAudioMessageRawPayload
  | DTVideoMessageRawPayload
  | DTPictureMessageRawPayload;

// @public (undocumented)
export type DTMessageRawPayload =
  | DTTextMessageRawPayload
  | DTRichTextMessageRawPayload
  | DTFileMessageRawPayload
  | DTAudioMessageRawPayload
  | DTVideoMessageRawPayload
  | DTPictureMessageRawPayload
  | DTUnknownMessageRawPayload;

// @public
export interface DTMessageRawPayloadBase {
  atUsers?: Array<{
    dingtalkId: string;
    staffId?: string;
  }>;
  chatbotCorpId: string;
  chatbotUserId: string;
  conversationId: string;
  conversationTitle?: string;
  conversationType: '1' | '2';
  createAt: number;
  isAdmin: boolean;
  isInAtList?: boolean;
  msgId: string;
  msgtype: string;
  robotCode: string;
  senderCorpId: string;
  senderId: string;
  senderNick: string;
  senderStaffId?: string;
  sessionWebhook: string;
  sessionWebhookExpiredTime: number;
}

// @public (undocumented)
export function dtMessageToWechaty(_: PuppetDingTalk, payload: DTMessageRawPayload): Promise<PUPPET.payloads.Message>;

// @public (undocumented)
export enum DTMessageType {
  // (undocumented)
  Audio = 'audio',
  // (undocumented)
  File = 'file',
  // (undocumented)
  Image = 'picture',
  // (undocumented)
  RichText = 'richText',
  // (undocumented)
  Text = 'text',
  // (undocumented)
  Unknown = 'unknownMsgType',
  // (undocumented)
  Video = 'video',
}

// @public (undocumented)
export interface DTPictureMessageRawPayload extends DTMessageRawPayloadBase {
  // (undocumented)
  content: {
    pictureDownloadCode: string;
    downloadCode: string;
  };
  // (undocumented)
  msgtype: 'picture';
}

// @public (undocumented)
export type DTRichSection = DTRichSection.Picture | DTRichSection.Text;

// @public (undocumented)
export namespace DTRichSection {
  // (undocumented)
  export type Picture = {
    downloadCode: string;
    type: 'picture';
  };
  // (undocumented)
  export type Text = {
    text: string;
  };
}

// @public (undocumented)
export interface DTRichTextMessageRawPayload extends DTMessageRawPayloadBase {
  // (undocumented)
  content: {
    richText: DTRichSection[];
  };
  // (undocumented)
  msgtype: 'richText';
}

// @public (undocumented)
export function dtRoomMemberToWechaty(rawPayload: DTContactRawPayload): PUPPET.payloads.RoomMember;

// @public (undocumented)
export interface DTRoomRawPayload extends PUPPET.payloads.Room {
  sessionWebhook: string;
  sessionWebhookExpiredTime: number;
}

// @public (undocumented)
export function dtRoomToWechaty(_: PUPPET.Puppet, payload: DTRoomRawPayload): Promise<PUPPET.payloads.Room>;

// @public
export interface DTSessionWebhookRawPayload {
  chatbotUserId: string;
  conversationId: string;
  msgId: string;
  senderId: string;
  sessionWebhook: string;
  sessionWebhookExpiredTime: number;
}

// @public (undocumented)
export interface DTTextMessageRawPayload extends DTMessageRawPayloadBase {
  // (undocumented)
  msgtype: 'text';
  // (undocumented)
  text: {
    content: string;
  };
}

// @public (undocumented)
export interface DTUnknownMessageRawPayload extends DTMessageRawPayloadBase {
  // (undocumented)
  content: {
    unknownMsgType: string;
  };
  // (undocumented)
  msgtype: 'unknownMsgType';
}

// @public (undocumented)
export interface DTVideoMessageRawPayload extends DTMessageRawPayloadBase {
  // (undocumented)
  content: {
    duration: number;
    downloadCode: string;
    videoType: string;
  };
  // (undocumented)
  msgtype: 'video';
}

// @public
export type EmptyMessagePayload = {
  msgtype: 'empty';
};

// @public
export type FeedCardMessagePayload = {
  msgtype: 'feedCard';
  feedCard: {
    links: FeedLink[];
  };
};

// @public (undocumented)
export type FeedLink = {
  title: string;
  messageURL: string;
  picURL: string;
};

// @public (undocumented)
export type FileMessagePayload = {
  msgtype: 'file';
  file: {
    mediaId: string;
    fileName: string;
    fileType: string;
  };
};

// @public
export type GetMediaDurationInSeconds = (fileBox: FileBoxInterface) => Promise<number>;

// @public (undocumented)
export type ImageMessagePayload = {
  msgtype: 'image';
  image: {
    picURL: string;
  };
};

// @public
export type LinkMessagePayload = {
  msgtype: 'link';
  link: {
    text: string;
    title: string;
    picUrl: string;
    messageUrl: string;
  };
};

// Warning: (ae-forgotten-export) The symbol "WithAt" needs to be exported by the entry point index.d.ts
//
// @public
export type MarkdownMessagePayload = WithAt<{
  msgtype: 'markdown';
  markdown: {
    title: string;
    text: string;
  };
}>;

// Warning: (ae-forgotten-export) The symbol "MessagePayloadMap" needs to be exported by the entry point index.d.ts
//
// @public
export type MessagePayload = MessagePayloadMap[MessageType];

// @public
export enum MessageType {
  // (undocumented)
  ActionCard = 'actionCard',
  // (undocumented)
  Audio = 'audio',
  // (undocumented)
  Empty = 'empty',
  // (undocumented)
  FeedCard = 'feedCard',
  // (undocumented)
  File = 'file',
  // (undocumented)
  Image = 'image',
  // (undocumented)
  Link = 'link',
  // (undocumented)
  Markdown = 'markdown',
  // (undocumented)
  Text = 'text',
  // (undocumented)
  Video = 'video',
}

// @public (undocumented)
export class PuppetDingTalk extends PUPPET.Puppet {
  constructor(options?: PuppetDingTalkOptions);
  // (undocumented)
  protected _clearCacheAfterLogout: boolean;
  // (undocumented)
  contactRawPayload(contactId: string): Promise<DTContactRawPayload | void>;
  // (undocumented)
  contactRawPayloadParser(rawPayload: DTContactRawPayload): Promise<PUPPET.payloads.Contact>;
  // (undocumented)
  protected _contactsStore: Keyv<DTContactRawPayload>;
  // (undocumented)
  protected _dkClient: Dingtalk;
  // (undocumented)
  protected _dkConnection?: HubConnection;
  // (undocumented)
  protected _dkCredential: AuthCredential;
  // (undocumented)
  protected _getAudioDurationInSeconds: GetMediaDurationInSeconds;
  // (undocumented)
  protected _getVideoDurationInSeconds: GetMediaDurationInSeconds;
  // (undocumented)
  messageFile(messageId: string): Promise<FileBoxInterface>;
  // (undocumented)
  messageImage(messageId: string, imageType: PUPPET.types.Image): Promise<FileBoxInterface>;
  // (undocumented)
  messageRawPayload(messageId: string): Promise<DTMessageRawPayload>;
  // (undocumented)
  messageRawPayloadParser(rawPayload: DTMessageRawPayload): Promise<PUPPET.payloads.Message>;
  // (undocumented)
  messageSendFile(conversationId: string, fileBox: FileBoxInterface): Promise<void>;
  // (undocumented)
  messageSendText(
    conversationId: string, // TODO 群或联系人ID?
    content: string,
    mentionIdList?: string[],
  ): Promise<void>;
  // (undocumented)
  messageSendUrl(conversationId: string, urlLinkPayload: PUPPET.payloads.UrlLink | MessagePayload): Promise<void>;
  // (undocumented)
  protected _messagesStore: Keyv<DTMessageRawPayload>;
  // (undocumented)
  onStart(): Promise<void>;
  // (undocumented)
  onStop(): Promise<void>;
  // (undocumented)
  roomMemberList(roomId: string): Promise<string[]>;
  // (undocumented)
  roomMemberRawPayload(roomId: string, contactId: string): Promise<DTContactRawPayload | void>;
  // (undocumented)
  roomMemberRawPayloadParser(rawPayload: DTContactRawPayload): Promise<PUPPET.payloads.RoomMember>;
  // (undocumented)
  roomRawPayload(roomId: string): Promise<DTRoomRawPayload>;
  // (undocumented)
  roomRawPayloadParser(rawPayload: DTRoomRawPayload): Promise<PUPPET.payloads.Room>;
  // (undocumented)
  protected _roomsStore: Keyv<DTRoomRawPayload>;
  // (undocumented)
  protected _sessionWebhooksStore: Keyv<DTSessionWebhookRawPayload>;
  // (undocumented)
  protected unstable_defaultGetAudioDurationInSeconds: GetMediaDurationInSeconds;
  // (undocumented)
  protected unstable_defaultGetVideoDurationInSeconds: GetMediaDurationInSeconds;
}

// @public (undocumented)
export interface PuppetDingTalkOptions extends PUPPET.PuppetOptions {
  clearCacheAfterLogout?: boolean;
  clientId?: string;
  clientSecret?: string;
  contactsStore?: Keyv<DTContactRawPayload>;
  credential?: AuthCredential;
  getAudioDurationInSeconds?: GetMediaDurationInSeconds;
  getVideoDurationInSeconds?: GetMediaDurationInSeconds;
  messagesStore?: Keyv<DTMessageRawPayload>;
  roomsStore?: Keyv<DTRoomRawPayload>;
  sessionWebhooksStore?: Keyv<DTSessionWebhookRawPayload>;
}

// @public (undocumented)
export type Sayable = string | MessagePayload;

// @public (undocumented)
export class SayableSayer extends Sender {
  // (undocumented)
  protected atUserIds(message: MarkdownMessagePayload | TextMessagePayload, mentionIdList: string[]): void;
  // (undocumented)
  protected mention(message: MessagePayload, mentionIdList: true | string[]): void;
  // (undocumented)
  protected resolve(sayable: Sayable): Promise<MessagePayload>;
  // (undocumented)
  say(sayable: Sayable): Promise<any>;
  // (undocumented)
  say(sayable: Sayable, atAll: true): Promise<any>;
  // (undocumented)
  say(sayable: Sayable, mentionIdList: string[]): Promise<any>;
}

// @public (undocumented)
export class Sender {
  constructor(url: string, expiredTime?: number);
  // (undocumented)
  protected expiredTime: number;
  // (undocumented)
  isExpired(): boolean;
  // (undocumented)
  send(message: MessagePayload): Promise<void>;
  // (undocumented)
  protected url: string;
}

// @public (undocumented)
export type SimpleActionCard = {
  title: string;
  text: string;
  singleTitle: string;
  singleURL: string;
};

// @public
export type TextMessagePayload = WithAt<{
  msgtype: 'text';
  text: {
    content: string;
  };
}>;

// @public (undocumented)
export type VideoMessagePayload = {
  msgtype: 'video';
  video: {
    picMediaId: string;
    videoMediaId: string;
    videoType: string;
    duration: string | number;
    width?: string;
    height?: string;
  };
};

// (No @packageDocumentation comment for this package)
```
